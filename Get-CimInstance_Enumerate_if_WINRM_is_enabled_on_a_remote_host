Test-NetConnection -ComputerName LAB_WIN11_1 -Port 5985

PS C:\Users\User1> Test-NetConnection -ComputerName LAB_WIN11_1 -Port 5985
WARNING: TCP connect to (192.168.68.114 : 5985) failed


ComputerName           : LAB_WIN11_1
RemoteAddress          : 192.168.68.114
RemotePort             : 5985
InterfaceAlias         : Ethernet0
SourceAddress          : 192.168.68.113
PingSucceeded          : True
PingReplyDetails (RTT) : 3 ms
TcpTestSucceeded       : False


Trying to enable WINRM as a domain user

PS C:\Users\User1> winrm quickconfig
WinRM is not set up to receive requests on this machine.
The following changes must be made:

Start the WinRM service.
Set the WinRM service type to delayed auto start.

Make these changes [y/n]? y

Error: One or more update steps could not be completed.

Could not change the WinRM service type: Access is denied.
Could not start the WinRM service: Access is denied.
WSManFault
    Message = The client cannot connect to the destination specified in the request. Verify that the service on the destination is running and is accepting requests. Consult the logs and documentation for the WS-Management service running on the destination, most commonly IIS or WinRM. If the destination is the WinRM service, run the following command on the destination to analyze and configure the WinRM service: "winrm quickconfig".

Error number:  -2144108526 0x80338012
The client cannot connect to the destination specified in the request. Verify that the service on the destination is running and is accepting requests. Consult the logs and documentation for the WS-Management service running on the destination, most commonly IIS or WinRM. If the destination is the WinRM service, run the following command on the destination to analyze and configure the WinRM service: "winrm quickconfig".


Trying to enable WINRM as a member of domain admins group


PS C:\Windows\system32> winrm quickconfig
WinRM is not set up to receive requests on this machine.
The following changes must be made:

Start the WinRM service.
Set the WinRM service type to delayed auto start.

Make these changes [y/n]? y

WinRM has been updated to receive requests.

WinRM service type changed successfully.
WinRM service started.
WinRM is not set up to allow remote access to this machine for management.
The following changes must be made:

Enable the WinRM firewall exception.

Make these changes [y/n]? y

WinRM has been updated for remote management.

WinRM firewall exception enabled.
PS C:\Windows\system32>


Testing if WINRM is enabled on remote host

PS C:\Users\User1> Test-NetConnection -ComputerName LAB_WIN11_1 -Port 5985


ComputerName     : LAB_WIN11_1
RemoteAddress    : 192.168.68.114
RemotePort       : 5985
InterfaceAlias   : Ethernet0
SourceAddress    : 192.168.68.113
TcpTestSucceeded : True


Running a remote WINRM request for all local shares with a domain user after enabling WINRM on the remote host

PS C:\Users\User1> Get-CimInstance -ClassName Win32_Share -ComputerName LAB_WIN11_1
Get-CimInstance : Access is denied.
At line:1 char:1
+ Get-CimInstance -ClassName Win32_Share -ComputerName LAB_WIN11_1
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : PermissionDenied: (root\cimv2:Win32_Share:String) [Get-CimInstance], CimException
    + FullyQualifiedErrorId : HRESULT 0x80070005,Microsoft.Management.Infrastructure.CimCmdlets.GetCimInstanceCommand
    + PSComputerName        : LAB_WIN11_1

Same as above but with an account that a member of domain admins group

PS C:\Windows\system32> Get-CimInstance -ClassName Win32_Share -ComputerName LAB_WIN11_1

Name   Path                        Description   PSComputerName
----   ----                        -----------   --------------
ADMIN$ C:\Windows                  Remote Admin  LAB_WIN11_1
C$     C:\                         Default share LAB_WIN11_1
IPC$                               Remote IPC    LAB_WIN11_1
Test   C:\Users\User1\Desktop\Test               LAB_WIN11_1
Users  C:\Users                                  LAB_WIN11_1
Work   C:\Shares\Work                            LAB_WIN11_1
Work2  C:\Shares\Work                            LAB_WIN11_1
